# 라이트 하우스 점수 향상기

## Lighthouse란 무엇인가?

LightHouse는 Google에서 개발한 오픈 소스 자동화 도구로, 웹 페이지의 품질을 개선하기 위해 사용된다.

- 성능 , 접근성, SEO(검색 엔진 최적화),PWA(Progressive Web App) 적합성 평가 및 점수 측정
- LightHouse는 Chrome DevTools, Node, CLI을 통해 실행할 수 있다.

상세한 내용 : [detail](/BASE/Lighthouse.md)

## 성능 최적화 경험기 : 91점에서의 만족

이전에 인자강의 메인 페이지를 라이트하우스(Lighthouse)로 검사한 결과, 개발 모드에서 40점대, 프로덕션 모드에서는 60점이라는 충격적인 점수를 받았습니다. 이에 여러 가지 최적화 작업을 통해 점수를 91점까지 끌어올리며 뿌듯함을 느꼈습니다. 그러나 지금 돌이켜보면, 91점에서 만족할 것이 아니라, 토이 프로젝트 같은 경우는 100점을 목표로 했어야 했습니다.

## 이전 문제 상황

메인 페이지의 경우, 스크롤을 내리면 홈페이지의 기능을 설명하는 문구와 이미지가 뜨는 애니메이션이 발생합니다. 하지만 여기서 사용되는 이미지가 최적화되지 않아 로딩 시간이 지연되는 것이 주요 문제점이었습니다.

## 이전 해결 방법

1. 이미지를 `Webp`형식으로 변환하여 파일용량을 줄였습니다. `webp`의 경우 JPEG나 PNG 포맷에 비해 용량이 작아 로딩 속도를 크게 개선할 수 있습니다.
2. 초기 화면 구성 시 필요하지 않은 후속 기능을 설명하는 이미지 컴포넌트의 경우 `React.lazy`를 활용하여 코드 스플리팅을 분할하였습니다. 이를 통해 초기 로딩 시간을 단축하고, 필요한 시점에만 로딩되도록 하였습니다.

## 성능 최적화 경험기 : 100점을 향해

### 근본적인 문제 파악

> LightHouse의 경고 메시지로는 근본적인 문제를 파악 할 수 없는 상황

1. **레이아웃의 문제 점검**

- 전체 페이지를 공통적으로 구성하는 레이아웃을 점검
- 새로운 페이지를 생성하여 순수 레이아웃의 `score`를 비교해봤습니다.

[ **Score : 100점** ]

2. **컴포넌트의 문제 점검**

- 페이지를 구성하는 컴포넌트의 문제를 검사
- 순수한 레이아웃의 적용 결과, 각각의 컴포넌트를 생성하여 점검했습니다.

[ **예상외의 결과** : 단순 스타일버튼 컴포넌트 최하점 기록 ]

3. **순수한 styled컴포넌트 점검**

- styled 문제를 점검하기 위한 점검 과정
- 아무런 속성이 적용되지 않은 순수한 스타일 컴포넌트를 생성하여 점검 하였습니다.

[**Score : 70점 중후반**]

4. **일반 HTML태그를 점검**

- 일반적인 태그 <`div/`>를 적용한 결과를 점검 하였습니다.
- 일반적인 태그를 사용할 경우 90점대를 기록

[**결론 : Styled자체의 문제일 확률 높음**]

## Styled 문제 해결 

이 문제는 이전에 X_clone 프로젝트를 진행하면서 하이드레이션과 관련된 오류를 해결했던 경험과 유사합니다. styled-components와 같은 CSS-in-JS 라이브러리는 프로젝트가 실행 중일 때 DOM 요소에 스타일을 주입합니다. 그러나 서버 사이드 렌더링(SSR)을 사용하는 Next.js에서는 이러한 스타일 주입 과정에서 LCP(Largest Contentful Paint)의 시간 차이가 발생하여 LightHouse 점수가 급격히 떨어질 수 있습니다.

이러한 문제를 해결하기 위해서는 ServerStyleSheet를 활용하여 SSR 방식으로 styled-components를 지원하면 됩니다
