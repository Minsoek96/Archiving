# 캐시 라이프 사이클 

>**Query Instances with and without cache data**(캐시 데이터가 있거나 없는 쿼리 인스턴스)  
**Background Refetching**(백그라운드 리패칭)  
**Inactive Queries**(비활성 쿼리)  
**Garbage Collection**(가비지 컬렉션)  

## 시나리오 

> gcTime의 기본값 5분, staleTime 기본값 0초를 가정 
 
### 캐시 데이터가 있거나 없는 쿼리 인스턴스 

> 쿼리 인스턴스는 특정 쿼리 키(`queryKey`)를 가지고 있으며 이를 기반으로 데이터를 패치하고 캐싱한다. 

**캐시에 데이터가 이미 존재한다면?**  
새로운 쿼리 인스턴스가 `mount`될 때 네트워크 요청 없이 캐시된 데이터를 바로 사용할 수 있다. 

**캐시에 데이터가 없다면?**  
쿼리 인스턴스는 네트워크에서 데이터를 `fetch`하고, 이를 캐시한다. 
  
---

### 백그라운드 리패칭 

> 사용자의 인터랙션이 없는 동안에도, `React Query`는 설정에 따라 백그라운드에서 자동으로 데이터를 새로고침(`refetch`)할 수 있다.

- 데이터가 항상 최신 상태를 유지하도록 하여 사용자 경험을 향상 시킨다.
  
---

### 비활성 쿼리 

> 쿼리 인스턴스가 `unmount`되면 해당 쿼리는 비활성 상태가 된다.

- 비활성 쿼리의 데이터는 설정된 `gcTime` 동안 캐시에 남아 있는다.
  
---

### 가비지 컬렉션 

> `gcTime` 은 기본적으로 5분으로 설정되어 있으며, 이 시간 동안 쿼리 데이터는 캐시에 유지 된다. 

- `gcTime`이 지나면, 비활성 상태인 쿼리 데이터는 메모리 최적화를 위해 캐시에서 제거 된다. 
  
---

## 데이터 신선도 

> Fresh -> Stale -> gcTime

**staleTime** = 0초
**cacheTime** = 5분(300,000밀리초)

### Fresh(신선)

> 데이터가 처음 패칭되어 캐시에 저장되면 초기 상태는 `fresh`로 간주된다.  
신선한 상태 이므로 추가적인 네트워크 요청 없이 즉시 사용된다.

`fresh`상태의 시간은 `staleTime`에 의해 결정된다. 기본적으로 `staleTime`은 0초로 설정되어 있어 데이터 패칭후 즉시 `stale`상태로 전환된다.
  
---


### Stale(오래됨)

> `staleTime`이 경과하면, 데이터는 `stale`상태로 전환된다.  
신선하지 않은 상태라 최신 데이터로 `refetch`를 시도할 수 있다.

`stale` 데이터는 백그라운드에서 최신 데이터를 가져오기 위한 요청을 진행하여 사용자의 경험을 저하시키지 않고 데이터를 최신 상태로 유지할 수 있다.

### 가비지 컬렉션(GC)

> `stale` 상태의 데이터도 일정시간 `cacheTime`이 지나면, 더 이상 사용되지 않을  때 가비지 컬렉터에 의해 캐시에서 제거된다.

`cacheTime` === `gcTime`

